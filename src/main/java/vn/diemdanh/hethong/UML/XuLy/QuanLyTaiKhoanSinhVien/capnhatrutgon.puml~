@startuml
!theme plain
title Cập nhật tài khoản sinh viên

actor "Admin" as User

participant "Danh sách SV\n(Component)" as Component
participant "Modal & Form\n(Ant Design)" as Modal
participant "userService.js\n(Frontend Service)" as FrontendService
participant "UserController.java\n(Controller)" as Controller
participant "UserService.java\n(Service)" as Service
participant "UserRepository.java\n(Repository)" as Repository
database "CSDL" as DB

== Mở form ==
User -> Component: Click "Sửa"
Component -> Modal: Hiển thị form cập nhật

== Submit cập nhật ==
User -> Modal: Chỉnh sửa th Click "Lưu"
Modal -> Component: onFinish(values)
Component -> FrontendService: updateUser(id, payload)

== Gọi API ==
FrontendService -> Controller: PUT /api/users/{id}
Controller -> Service: updateUser(id, userDto)
Service -> Repository: findById(id)
Repository -> DB: Truy vấn user
DB --> Repository: User (hoặc null)

alt User không tồn tại
    Service --> Controller: throw lỗi
    Controller --> FrontendService: 404 Not Found
    FrontendService --> Component: Hiển thị lỗi
else Tồn tại
    == Kiểm tra trùng email/username ==
    Service -> Repository: check duplicate
    Repository -> DB: Truy vấn
    DB --> Repository: count
    alt Trùng
        Service --> Controller: throw lỗi
        Controller --> FrontendService: 400 Bad Request
        FrontendService --> Component: Hiển thị lỗi
    else Không trùng
        == Cập nhật ==
        Service -> Repository: save(updatedUser)
        Repository -> DB: UPDATE
        DB --> Repository: updated entity
        Repository --> Service: entity
        Service --> Controller: UserDto
        Controller --> FrontendService: 200 OK
        FrontendService --> Component: Success
        Component -> User: Đóng form, thông báo thành công
    end
end

@enduml
