@startuml
!theme plain
title 2. Đăng nhập Quản Trị viên (Admin Login)

participant "api.js" as API
participant "AuthController" as AUTH
participant "UserService" as US
participant "JwtTokenProvider" as JWT
database "UserRepository" as UR

== Xử lý đăng nhập cho Quản Trị viên ==

API -> AUTH: POST /api/admin/login\n{email, password}
activate AUTH

AUTH -> AUTH: Tạo UsernamePasswordAuthenticationToken

AUTH -> US: Xác thực qua AuthenticationManager
activate US

US -> UR: loadUserByUsername(email)
activate UR

alt Không tìm thấy user hoặc sai password
    UR --> US: User not found/Invalid password
    deactivate UR

    US --> AUTH: BadCredentialsException
    deactivate US

    AUTH --> API: 400 "Email hoặc mật khẩu không chính xác"
    deactivate AUTH
else Xác thực thành công
    UR --> US: CustomAdminDetails (ROLE_ADMIN)
    deactivate UR

    US --> AUTH: Authentication success
    deactivate US

    AUTH -> JWT: generateToken(userDetails)
    activate JWT
    note right: JWT chứa:\n- userId, email, role\n- username, userType="ADMIN"
    JWT --> AUTH: JWT token
    deactivate JWT

    AUTH --> API: UserLoginResponse:\n{accessToken, id, username, email, role="ADMIN"}
    deactivate AUTH
end

@enduml
