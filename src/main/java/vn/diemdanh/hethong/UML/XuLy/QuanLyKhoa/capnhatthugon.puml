@startuml
!theme plain
title Cập nhật khoa

actor "Admin" as admin

participant "DanhSachKhoaComponents" as component
participant "KhoaModal & Form" as modal
participant "khoaService.js" as service
participant "khoaController.java" as controller
participant "khoaService.java" as backendService
participant "KhoaRepository" as repository
database "Database" as db

admin -> component: Click "Sửa" button
component -> modal: Hiển thị modal
modal -> admin: Hiển thị form

admin -> modal: Chỉnh sửa và submit
modal -> modal: validateFields()

alt Validation thành công
    modal -> component: handleModalOk(values)
    component -> service: updateKhoa(maKhoa, values)
    service -> controller: PUT /api/khoa/{maKhoa}
    controller -> backendService: updateKhoa(maKhoa, data)
    backendService -> repository: findById(maKhoa)
    repository -> db: Truy vấn

    alt Khoa tồn tại
        db --> repository: Khoa entity
        repository --> backendService: Khoa entity

        backendService -> backendService: Cập nhật
        backendService -> repository: save(updatedEntity)
        repository -> db: UPDATE khoa
        db --> repository: Updated entity
        repository --> backendService: Updated entity

        backendService -> backendService: Chuyển thành DTO
        backendService --> controller: KhoaDTO
        controller --> service: 200 OK + DTO
        service --> component: Thành công

        component -> component: message.success()
        component -> component: fetchKhoas()
        component -> modal: Đóng modal
        component -> admin: Thông báo thành công

    else Khoa không tồn tại
        db --> repository: null
        repository --> backendService: null
        backendService --> controller: 404 Not Found
        controller --> service: Lỗi
        service --> component: message.error()
        component -> admin: Thông báo lỗi
    end

else Validation thất bại
    modal -> admin: Hiển thị lỗi validation
end
@enduml
