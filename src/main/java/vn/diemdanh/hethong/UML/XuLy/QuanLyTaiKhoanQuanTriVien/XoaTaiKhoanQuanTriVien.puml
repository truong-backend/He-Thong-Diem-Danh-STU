@startuml
!theme plain
title Luồng xóa tài khoản quản trị viên

actor Admin as admin
participant "DanhSachTaiKhoanAdminComponents.jsx" as component
participant "Popconfirm" as confirm
participant "adminService.js" as service
participant "AdminController.java" as controller
participant "AdminService.java" as adminService
participant "AdminRepository.java" as repository
database "Database" as db

admin -> component: Click nút "Xóa" trong bảng
activate component
component -> confirm: Hiển thị Popconfirm
activate confirm
confirm --> admin: "Bạn có chắc chắn muốn xóa?"

alt Admin hủy
    admin -> confirm: Cancel
    confirm -> component: Không thực hiện gì
else Admin xác nhận
    admin -> confirm: OK
    confirm -> component: handleDelete(id)

    component -> service: deleteAdmin(id)
    activate service
    service -> controller: DELETE /api/admin/{id}
    activate controller
    controller -> adminService: deleteAdmin(id)
    activate adminService

    adminService -> repository: findById(id)
    activate repository
    repository -> db: SELECT * FROM admin WHERE id = ?

    alt Admin không tồn tại
        db --> repository: null
        repository --> adminService: Optional.empty()
        adminService --> controller: Ném exception
        controller --> service: Error response
        service --> component: Error
        component -> component: message.error()
    else Admin tồn tại
        db --> repository: Admin entity
        repository --> adminService: Admin entity

        adminService -> repository: delete(admin)
        repository -> db: DELETE FROM admin WHERE id = ?
        db --> repository: Success
        deactivate repository
        repository --> adminService: Success
        adminService --> controller: Success
        deactivate adminService
        controller --> service: Success response
        deactivate controller
        service --> component: Success
        deactivate service

        component -> component: message.success()
        component -> component: fetchAdmins() - Cập nhật danh sách
    end
end

deactivate confirm
deactivate component
@enduml