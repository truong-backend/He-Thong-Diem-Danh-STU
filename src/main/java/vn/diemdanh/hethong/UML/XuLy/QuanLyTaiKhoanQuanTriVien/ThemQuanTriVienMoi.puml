@startuml
!theme plain
title Luồng thêm tài khoản quản trị viên mới

actor Admin as admin
participant "DanhSachTaiKhoanAdminComponents.jsx" as component
participant "Modal (Ant Design)" as modal
participant "Form" as form
participant "adminService.js" as service
participant "AdminController.java" as controller
participant "AdminService.java" as adminService
participant "AdminRepository.java" as repository
database "Database" as db

admin -> component: Click "Thêm Quản trị viên"
activate component
component -> modal: Mở modal
activate modal
modal -> form: Hiển thị form
activate form
note right of form
Các trường form:
- username (required)
- password (required)
- fullName (required)
- email (required)
- role (default: "admin")
- avatar (optional)
end note

admin -> form: Điền thông tin
admin -> form: Submit form
form -> component: handleModalOk()
component -> component: form.validateFields()
component -> component: Tạo FormData
note right
FormData bao gồm:
- username, password, fullName, email, role
- avatar file (nếu có)
end note

component -> service: createAdmin(formData)
activate service
service -> controller: POST /api/admin
activate controller
controller -> adminService: createAdmin(request)
activate adminService

adminService -> adminService: Kiểm tra email trùng lặp
adminService -> adminService: Kiểm tra username trùng lặp
alt Email hoặc username đã tồn tại
    adminService --> controller: Ném exception
    controller --> service: Error response
    service --> component: Error
    component -> component: message.error()
else Thông tin hợp lệ
    adminService -> adminService: Mã hóa password
    adminService -> adminService: Tạo Admin entity
    adminService -> repository: save(admin)
    activate repository
    repository -> db: INSERT INTO admin
    db --> repository: Admin entity
    deactivate repository
    repository --> adminService: Admin entity
    adminService -> adminService: Convert to AdminDto
    adminService --> controller: AdminDto
    deactivate adminService
    controller --> service: Success response
    deactivate controller
    service --> component: AdminDto
    deactivate service

    component -> component: message.success()
    component -> component: fetchAdmins() - Cập nhật danh sách
    component -> modal: Đóng modal
end

deactivate form
deactivate modal
deactivate component
@enduml