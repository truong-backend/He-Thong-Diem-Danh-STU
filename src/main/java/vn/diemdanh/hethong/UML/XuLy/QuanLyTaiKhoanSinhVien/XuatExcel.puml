@startuml
'!theme cerulean
title Sơ đồ Xuất Excel - Danh sách Tài Khoản Sinh Viên

actor "Admin" as admin
participant "DanhSachTaiKhoanSinhVienComponents.jsx" as component
participant "userService" as service
participant "XLSX Library" as xlsx
participant "file-saver" as fileSaver
participant "Browser" as browser

admin -> component: Click "Xuất Excel"
activate component

component -> service: getUsersByRole(STUDENT, page=0, size=1000, ...)
activate service
service --> component: Danh sách tài khoản sinh viên (content[])
deactivate service

alt Không có dữ liệu
    component -> component: Hiển thị message.warning
    component --> admin: Thông báo "Không có dữ liệu để xuất"
    deactivate component
else Có dữ liệu
    component -> component: map dữ liệu thành Excel data array

    loop Với mỗi giảng viên
        component -> component: Thêm dòng [STT, ID, Họ tên, Username, Email,...]
    end

    component -> xlsx: XLSX.utils.book_new()
    activate xlsx
    xlsx --> component: workbook

    component -> xlsx: XLSX.utils.json_to_sheet(data)
    xlsx --> component: worksheet

    component -> xlsx: Thiết lập độ rộng cột
    component -> xlsx: XLSX.utils.book_append_sheet(wb, ws, "Danh sách tài khoản sinh viên")

    component -> xlsx: XLSX.write(wb, type='array')
    xlsx --> component: ExcelBuffer
    deactivate xlsx

    component -> component: new Blob([ExcelBuffer])
    component -> fileSaver: saveAs(blob, filename)
    activate fileSaver
    fileSaver -> browser: Trigger download
    browser --> admin: File được tải về
    deactivate fileSaver

    component -> component: message.success("Xuất Excel thành công")
    component --> admin: Thông báo thành công
end

deactivate component

note over component
- Dữ liệu lấy từ API (không dùng state hiện tại)
- Không phân trang (lấy tối đa 1000 bản ghi)
- Tự động format ngày
- Tên file: "danh-sach-giang-vien-YYYY-MM-DD-HH-mm.xlsx"
end note

note over xlsx, fileSaver
Sử dụng thư viện:
- xlsx: tạo Excel
- file-saver: tải xuống file
end note

@enduml
