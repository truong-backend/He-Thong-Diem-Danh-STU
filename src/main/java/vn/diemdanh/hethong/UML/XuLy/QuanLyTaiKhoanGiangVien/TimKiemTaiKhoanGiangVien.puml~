@startuml
title Tìm kiếm Giảng viên

actor "Admin" as admin
participant "DanhSachTaiKhoanGV\nComponent" as frontend
participant "Ant Design\nInput.Search" as searchInput
participant "userService.js" as service
participant "UserController" as controller
participant "UserService" as userService
participant "UserRepository" as repository
database "Database" as db

== Tìm kiếm Giảng viên ==
admin -> searchInput: Nhập từ khóa tìm kiếm
activate searchInput
searchInput -> frontend: onSearch(keyword)
activate frontend
frontend -> frontend: handleSearch(keyword)
frontend -> frontend: Update tableParams:\n- search: keyword\n- pagination.current: 1\n- Reset về trang đầu

frontend -> frontend: useEffect được trigger do tableParams thay đổi
frontend -> frontend: Gọi fetchTeachers() với search param

frontend -> service: getUsersByRole('TEACHER', page, size, sortBy, sortDir, search)
note right: Gửi thêm tham số search
activate service
service -> controller: GET /api/users/role/TEACHER?search=keyword&page=0&size=10
activate controller

controller -> controller: Kiểm tra tham số search
alt search param không rỗng
    controller -> userService: searchUsersByRole(role, search, pageable)
    activate userService
    userService -> repository: findByRoleAndSearch(TEACHER, keyword, pageable)
    activate repository
    repository -> db: SELECT * FROM users\nWHERE role='TEACHER'\nAND (username LIKE '%keyword%'\n     OR email LIKE '%keyword%'\n     OR fullName LIKE '%keyword%')\nORDER BY id LIMIT 10 OFFSET 0
    note right: Tìm kiếm trong 3 trường:\n- username\n- email\n- fullName
else search param rỗng
    controller -> userService: getUsersByRole(role, pageable)
    userService -> repository: findByRole(TEACHER, pageable)
    repository -> db: SELECT * FROM users WHERE role='TEACHER'\nORDER BY id LIMIT 10 OFFSET 0
end

db --> repository: List<User> matching search
repository --> userService: Page<User>
deactivate repository

userService -> userService: Convert to UserDto list
userService --> controller: Page<UserDto> (filtered results)
deactivate userService

controller --> service: JSON Response (filtered data)
deactivate controller

service --> frontend: filtered teachers data
deactivate service

frontend -> frontend: setState(teachers) với kết quả lọc
frontend -> frontend: Update pagination info cho kết quả tìm kiếm

frontend -> frontend: Render bảng với kết quả tìm kiếm
alt Có kết quả
    frontend -> admin: Hiển thị danh sách kết quả tìm kiếm
    note right: Highlight từ khóa tìm kiếm\ntrong kết quả (nếu có)
else Không có kết quả
    frontend -> admin: Hiển thị "Không tìm thấy kết quả"
    note right: Empty state with message\n"Không tìm thấy giảng viên nào"
end

== Xóa từ khóa tìm kiếm ==
admin -> searchInput: Xóa từ khóa hoặc click Clear
searchInput -> frontend: onSearch("")
frontend -> frontend: handleSearch("")
frontend -> frontend: Reset tableParams.search = ""
frontend -> frontend: Gọi lại fetchTeachers() không có search
frontend -> admin: Hiển thị lại toàn bộ danh sách
deactivate searchInput
deactivate frontend

@enduml