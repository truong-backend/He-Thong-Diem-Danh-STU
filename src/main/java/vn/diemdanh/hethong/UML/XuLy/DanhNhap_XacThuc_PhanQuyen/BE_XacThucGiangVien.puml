@startuml
!theme plain
title 3. Đăng nhập Giảng viên (Teacher Login)

participant "api.js" as API
participant "AuthController" as AUTH
participant "UserService" as US
participant "JwtTokenProvider" as JWT
database "UserRepository" as UR

== Xử lý đăng nhập cho Giảng viên ==

API -> AUTH: POST /api/giangvien/login\n{email, password}
activate AUTH

AUTH -> AUTH: Tạo UsernamePasswordAuthenticationToken
AUTH -> US: Xác thực qua AuthenticationManager
activate US

US -> UR: loadUserByUsername(email)
activate UR

alt Không tìm thấy user hoặc sai password
    UR --> US: User not found/Invalid password
    deactivate UR
    US --> AUTH: BadCredentialsException
    deactivate US
    AUTH --> API: 400 "Email hoặc mật khẩu không chính xác"
    deactivate AUTH
else Xác thực thành công
    UR --> US: CustomUserDetails (ROLE_TEACHER)
    deactivate UR

    US --> AUTH: Authentication success
    deactivate US

    AUTH -> JWT: generateToken(userDetails)
    activate JWT
    note right: JWT chứa:\n- userId, email, role\n- username, userType="USER"
    JWT --> AUTH: JWT token
    deactivate JWT

    AUTH --> API: UserLoginResponse:\n{accessToken, id, username, email, role="TEACHER"}
    deactivate AUTH
end

@enduml
