@startuml
!theme plain
title Xóa tài khoản sinh viên

actor "Admin" as User

participant "Danh sách SV\n(Component)" as Component
participant "Popconfirm\n(Xác nhận)" as Popconfirm
participant "userService.js" as FrontendService
participant "UserController.java" as Controller
participant "UserService.java" as Service
participant "UserRepository.java" as Repository
database "CSDL" as DB

== Bắt đầu xóa ==
User -> Component: Click "Xóa"
Component -> Popconfirm: Hiển thị xác nhận
Popconfirm -> User: Bạn có chắc muốn xóa?

alt Xác nhận
    User -> Popconfirm: Click "Có"
    Popconfirm -> Component: onConfirm()
    Component -> FrontendService: deleteUser(id)
    FrontendService -> Controller: DELETE /api/users/{id}
    Controller -> Service: deleteUser(id)
    Service -> Repository: findById(id)
    Repository -> DB: Truy vấn
    DB --> Repository: User hoặc null

    alt Không tồn tại
        Service --> Controller: throw lỗi
        Controller --> FrontendService: 404 Not Found
        FrontendService --> Component: Hiển thị lỗi
    else Tồn tại
        alt Có ràng buộc dữ liệu
            Service --> Controller: throw lỗi
            Controller --> FrontendService: 400 Bad Request
            FrontendService --> Component: Hiển thị lỗi
        else Không có ràng buộc
            Service -> Repository: delete(user)
            Repository -> DB: DELETE
            DB --> Repository: OK
            Repository --> Service: Done
            Service --> Controller: Success
            Controller --> FrontendService: 200 OK
            FrontendService --> Component: Hiển thị thành công
            Component -> User: Cập nhật danh sách
        end
    end
else Hủy
    User -> Popconfirm: Click "Không"
    Popconfirm -> Component: Không làm gì
end

@enduml
