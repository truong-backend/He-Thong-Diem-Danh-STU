@startuml
!theme plain
title 3. Đăng nhập Giảng viên (Teacher Login)

participant "api.js" as API
participant "AuthController" as AUTH
participant "UserService" as US
participant "JwtTokenProvider" as JWT
database "UserRepository" as UR

== Xử lý đăng nhập cho Giảng viên ==

API -> AUTH: POST /api/giangvien/login\n{email, password}

AUTH -> AUTH: Tạo UsernamePasswordAuthenticationToken
AUTH -> US: Xác thực qua AuthenticationManager
US -> UR: loadUserByUsername(email)

alt Không tìm thấy user hoặc sai password
    UR -> US: User not found/Invalid password
    US -> AUTH: BadCredentialsException
    AUTH -> API: 400 "Email hoặc mật khẩu không chính xác"
else Xác thực thành công
    UR -> US: CustomUserDetails (ROLE_TEACHER)
    US -> AUTH: Authentication success
    AUTH -> JWT: generateToken(userDetails)
    note right: JWT chứa:\n- userId, email, role\n- username, userType="USER"
    JWT -> AUTH: JWT token
    AUTH -> API: UserLoginResponse:\n{accessToken, id, username, email, role="TEACHER"}
end

@enduml