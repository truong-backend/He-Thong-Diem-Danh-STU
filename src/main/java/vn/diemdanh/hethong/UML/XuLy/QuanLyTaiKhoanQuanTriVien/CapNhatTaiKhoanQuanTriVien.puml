@startuml
!theme plain
title Luồng cập nhật tài khoản quản trị viên

actor Admin as admin
participant "DanhSachTaiKhoanAdminComponents.jsx" as component
participant "Modal" as modal
participant "Form" as form
participant "adminService.js" as service
participant "AdminController.java" as controller
participant "AdminService.java" as adminService
participant "AdminRepository.java" as repository
database "Database" as db

admin -> component: Click nút "Sửa" trong bảng
activate component
component -> component: showModal(record)
component -> modal: Mở modal
activate modal
component -> form: Điền thông tin hiện có
activate form


admin -> form: Chỉnh sửa thông tin
admin -> form: Submit form
form -> component: handleModalOk()
component -> component: form.validateFields()
component -> component: Tạo FormData với dữ liệu mới

component -> service: updateAdmin(editingAdmin.id, formData)
activate service
service -> controller: PUT /api/admin/{id}
activate controller
controller -> adminService: updateAdmin(id, request)
activate adminService

adminService -> repository: findById(id)
activate repository
repository -> db: SELECT * FROM admin WHERE id = ?
alt Admin không tồn tại
    db --> repository: null
    repository --> adminService: Optional.empty()
    adminService --> controller: Ném exception
    controller --> service: Error response
else Admin tồn tại
    db --> repository: Admin entity
    deactivate repository
    repository --> adminService: Admin entity

    adminService -> adminService: Cập nhật các trường


    adminService -> repository: save(updatedAdmin)
    activate repository
    repository -> db: UPDATE admin SET ... WHERE id = ?
    db --> repository: Updated entity
    deactivate repository
    repository --> adminService: Updated entity
    adminService -> adminService: Convert to AdminDto
    adminService --> controller: AdminDto
    deactivate adminService
    controller --> service: Success response
    deactivate controller
    service --> component: Updated AdminDto
end
deactivate service

component -> component: message.success()
component -> component: fetchAdmins() - Cập nhật danh sách
component -> modal: Đóng modal

deactivate form
deactivate modal
deactivate component
@enduml