@startuml
!theme plain
title Luồng hiển thị danh sách lớp học

participant "DanhSachLopComponents.jsx" as component
participant "lopService.js" as lopService
participant "khoaService.js" as khoaService
participant "LopController" as lopController
participant "KhoaController" as khoaController
participant "LopService" as lopServiceBE
participant "KhoaService" as khoaServiceBE
participant "LopRepository" as lopRepo
participant "KhoaRepository" as khoaRepo
database "Database" as db

== Component Mount ==
component -> component: useEffect() duoc goi
component -> component: Goi fetchData()

== Lay du lieu song song ==
par Lay danh sach lop hoc
    component -> lopService: getLopsKhongPhanTrang()
    lopService -> lopController: GET /api/lop/all
    lopController -> lopServiceBE: getAllLops()
    lopServiceBE -> lopRepo: findAll(Sort.by("maLop").ascending())
    lopRepo -> db: Query lay tat ca lop hoc
    db --> lopRepo: List<Lop> entities
    lopRepo --> lopServiceBE: List<Lop>
    lopServiceBE -> lopServiceBE: Chuyen doi sang List<LopDto>
    lopServiceBE --> lopController: List<LopDto>
    lopController --> lopService: JSON Response
    lopService --> component: Danh sach lop hoc
and Lay danh sach khoa
    component -> khoaService: getKhoas()
    khoaService -> khoaController: GET /api/khoa/all
    khoaController -> khoaServiceBE: getKhoas()
    khoaServiceBE -> khoaRepo: findAll()
    khoaRepo -> db: Query lay tat ca khoa
    db --> khoaRepo: List<Khoa> entities
    khoaRepo --> khoaServiceBE: List<Khoa>
    khoaServiceBE --> khoaController: List<Khoa>
    khoaController --> khoaService: JSON Response
    khoaService --> component: Danh sach khoa
end

== Xu ly du lieu Frontend ==
component -> component: Luu vao state allLops
component -> component: Luu vao state khoas
component -> component: applyFilters() - ap dung bo loc
component -> component: applySorting() - sap xep du lieu
component -> component: applyPagination() - phan trang
component -> component: Luu ket qua vao filteredLops

== Render UI ==
component -> component: Render Table voi columns:
note right
- Ma lop (maLop)
- Ten lop (tenLop)
- Khoa (tenKhoa)
- GVCN (gvcn)
- SDT GVCN (sdtGvcn)
- Thao tac (Sua, Xoa)
end note

@enduml