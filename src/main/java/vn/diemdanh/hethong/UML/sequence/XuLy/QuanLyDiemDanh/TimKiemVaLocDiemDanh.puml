@startuml
!theme plain
title Tìm kiếm và lọc điểm danh

actor "Admin" as admin
participant "DanhSachDiemDanhComponents.jsx" as component
participant "Ant Design Input.Search" as searchInput
participant "Ant Design Select" as selectLop
participant "Ant Design Select" as selectMonHoc
participant "diemdanhService.js" as diemdanhService
participant "DiemDanhController" as controller
participant "DiemDanhService (BE)" as service
participant "DiemDanhRepository" as repository
database "Database" as db

== Tìm kiếm theo từ khóa ==
admin -> searchInput: Nhập từ khóa (Mã điểm danh, MSSV, Tên môn)
searchInput -> component: onSearch(keyword)
component -> component: setSearchText(keyword)
component -> component: Gọi lại getFilteredData()

== Lọc theo lớp ==
admin -> selectLop: Chọn lớp
selectLop -> component: onChange(filterLop)
component -> component: setFilterLop(filterLop)
component -> component: Gọi lại getFilteredData()

== Lọc theo môn học ==
admin -> selectMonHoc: Chọn môn học
selectMonHoc -> component: onChange(filterMonHoc)
component -> component: setFilterMonHoc(filterMonHoc)
component -> component: Gọi lại getFilteredData()

== Lấy dữ liệu điểm danh (nếu cần) ==
alt Dữ liệu chưa có hoặc cần làm mới
    component -> diemdanhService: getAllDiemDanhNoPaging()
    diemdanhService -> controller: GET /api/diemdanh/all
    controller -> service: findAll()
    service -> repository: findAll()
    repository -> db: SELECT * FROM diem_danh
    db --> repository: List<DiemDanh>
    repository --> service: List<DiemDanh>
    service -> service: Chuyển sang List<DiemDanhDto>
    service --> controller: List<DiemDanhDto>
    controller --> diemdanhService: JSON Response
    diemdanhService --> component: Danh sách điểm danh
end

== Áp dụng tìm kiếm và lọc (client-side) ==
component -> component: Lọc danh sách theo:
note right
- Từ khóa (Mã điểm danh, MSSV, Tên môn)
- Lớp (tenLop)
- Môn học (tenMonHoc)
end note
component -> admin: Hiển thị kết quả tìm kiếm/lọc trong bảng
@enduml 