@startuml
!theme plain
title Luồng hiển thị danh sách lớp học

participant "DanhSachLopComponents.jsx" as component
participant "lopService.js" as lopService
participant "khoaService.js" as khoaService
participant "LopController" as lopController
participant "KhoaController" as khoaController
participant "LopService" as lopServiceBE
participant "KhoaService" as khoaServiceBE
participant "LopRepository" as lopRepo
participant "KhoaRepository" as khoaRepo
database "Database" as db

== Component Mount ==
component -> component: useEffect() được gọi
component -> component: Gọi fetchData()

== Lấy dữ liệu song song ==
par Lấy danh sách lớp học
    component -> lopService: getLopsKhongPhanTrang()
    lopService -> lopController: GET /api/lop/all
    lopController -> lopServiceBE: getAllLops()
    lopServiceBE -> lopRepo: findAll(Sort.by("maLop").ascending())
    lopRepo -> db: Query lấy tất cả lớp học
    db --> lopRepo: List<Lop> entities
    lopRepo --> lopServiceBE: List<Lop>
    lopServiceBE -> lopServiceBE: Chuyển đổi sang List<LopDto>
    lopServiceBE --> lopController: List<LopDto>
    lopController --> lopService: JSON Response
    lopService --> component: Danh sách lớp học
'and Lấy danh sách khoa
    component -> khoaService: getKhoas()
    khoaService -> khoaController: GET /api/khoa/all
    khoaController -> khoaServiceBE: getKhoas()
    khoaServiceBE -> khoaRepo: findAll()
    khoaRepo -> db: Query lấy tất cả khoa
    db --> khoaRepo: List<Khoa> entities
    khoaRepo --> khoaServiceBE: List<Khoa>
    khoaServiceBE --> khoaController: List<Khoa>
    khoaController --> khoaService: JSON Response
    khoaService --> component: Danh sách khoa
end

== Xử lý dữ liệu Frontend ==
component -> component: Lưu vào state allLops
component -> component: Lưu vào state khoas
component -> component: applyFilters() - áp dụng bộ lọc
component -> component: applySorting() - sắp xếp dữ liệu
component -> component: applyPagination() - phân trang
component -> component: Lưu kết quả vào filteredLops

== Render UI ==
component -> component: Render Table với columns:
note right
- Mã lớp (maLop)
- Tên lớp (tenLop)
- Khoa (tenKhoa)
- GVCN (gvcn)
- SĐT GVCN (sdtGvcn)
- Thao tác (Sửa, Xóa)
end note

@enduml